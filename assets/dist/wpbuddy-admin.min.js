jQuery(document).ready((function(t){var e=e||{};e={textareaInititalHeight:0,init:function(){this.cacheDom(),this.bindEvents(),this.runSettingsValidation(),this.textareaInititalHeight=this.$textarea.height()},cacheDom:function(){this.$wpbuddyForm=t("#wpbuddy-form"),this.$wpbuddySettingsForm=t("#wpbuddy-settings-form"),this.$wpbuddyLicenseStatus=t(".wpbuddy-license-status"),this.$wpbuddyLicenseField=t("input[name='wpbuddy_license_key']"),this.$wpbuddyLicenseStatusText=t(".wpbuddy-status-text"),this.$wpbuddyAdminSpinner=t(".wpbuddy-admin-spinner"),this.$wpbuddyFormSpinner=t(".wpbuddy-form-spinner"),this.$wpbuddyFormResult=t(".wpbuddy-form-result"),this.$wpbuddyFormResultSuccess=t(".wpbuddy-form-result__success"),this.$wpbuddyFormResultError=t(".wpbuddy-form-result__error"),this.$wpbuddyFormResultSuccessText=t(".wpbuddy-form-result__success__text"),this.$wpbuddyFormResultClose=t(".wpbuddy-form-result__close"),this.$wpbuddyFormResultErrorText=t(".wpbuddy-form-result__error__text"),this.$wpbuddyFormClose=t(".wpbuddy-form__close"),this.$wpbuddyFooterIcon=t(".wpbuddy-footer__icon"),this.$wpbuddyFormContainer=t(".wpbuddy-form__container"),this.$textarea=t("#wpbuddy-form__field__description"),this.$accordionHeader=t(".wpbuddy-accordion__header")},bindEvents:function(){this.$wpbuddyForm.on("submit",this.createTicket.bind(this)),this.$wpbuddyFormResultClose.on("click",this.closeFormResult.bind(this)),this.$wpbuddyFormClose.on("click",this.toggleForm.bind(this)),this.$wpbuddyFooterIcon.on("click",this.toggleForm.bind(this)),this.$textarea.on("input",this.textareaResize.bind(this)),this.$textarea.on("keyup",this.textareReset.bind(this)),this.$accordionHeader.on("click",this.toggleAccordion.bind(this))},runSettingsValidation:function(){this.$wpbuddySettingsForm.length&&this.validateSettings()},createTicket:function(e){e.preventDefault(),this.$wpbuddyFormSpinner.css("display","flex");var s=new FormData;s.append("image",t("#wpbuddy-form__field__file")[0].files[0]),s.append("title",t("#wpbuddy-form__field__title").val()),s.append("description",t("#wpbuddy-form__field__description").val()),s.append("priority_id",t("#wpbuddy-form__field__priority_id").val()),t.ajax({url:"".concat(WPBuddy.root,"wpbuddy/v1/create-ticket"),type:"POST",data:s,processData:!1,contentType:!1,beforeSend:function(t){t.setRequestHeader("X-WP-Nonce",WPBuddy.nonce)},success:function(e){if(e&&e.success&&(this.$wpbuddyForm[0].reset(),this.$textarea.attr("rows",1),this.$wpbuddyFormResult.css("display","flex"),this.$wpbuddyFormResultSuccess.css("display","block"),this.$wpbuddyFormContainer.removeClass("wpbuddy-form__container--error"),this.$wpbuddyFormContainer.addClass("wpbuddy-form__container--success"),this.$wpbuddyFormResultErrorText.html(""),$ticket_url=e.data.ticket_url,this.$wpbuddyFormResultSuccessText.html('<p>Thank you for contacting us. Your ticket has been created. You can view it <a href="'.concat($ticket_url,'" target="_blank">here</a></p>'))),e&&!e.success){var s;this.$wpbuddyFormResult.css("display","flex"),this.$wpbuddyFormResultError.css("display","block"),this.$wpbuddyFormContainer.removeClass("wpbuddy-form__container--success"),this.$wpbuddyFormContainer.addClass("wpbuddy-form__container--error"),this.$wpbuddyFormResultSuccessText.html(""),this.$wpbuddyFormResultErrorText.html(e.message);var i=null===(s=e.data)||void 0===s?void 0:s.errors;for(var d in i)t("#wpbuddy-form__field__".concat(d)).addClass("wpbuddy-form__field--error"),t(".wpbuddy-form__field__".concat(d,"__error")).html(i[d])}this.$wpbuddyFormSpinner.css("display","none")}.bind(this),error:function(t){console.log(t)}})},closeFormResult:function(){this.$wpbuddyFormResult.css("display","none"),this.$wpbuddyFormResultSuccess.css("display","none"),this.$wpbuddyFormResultError.css("display","none"),this.$wpbuddyFormContainer.removeClass("wpbuddy-form__container--success"),this.$wpbuddyFormContainer.removeClass("wpbuddy-form__container--error")},closeForm:function(){this.$wpbuddyFormResult.css("display","none"),this.$wpbuddyFormResultSuccess.css("display","none"),this.$wpbuddyFormResultError.css("display","none"),this.$wpbuddyFormContainer.removeClass("wpbuddy-form__container--success"),this.$wpbuddyFormContainer.removeClass("wpbuddy-form__container--error"),this.$wpbuddyFormContainer.css("display","none")},toggleForm:function(t){t.preventDefault(),this.$wpbuddyFormContainer.toggle()},textareaResize:function(){var t=parseInt(this.$textarea.css("line-height")),e=this.$textarea.prop("scrollHeight");if(e>this.textareaInititalHeight){var s=Math.floor(e/t);this.$textarea.attr("rows",s)}else""===this.$textarea.val()&&this.$textarea.attr("rows",1)},textareReset:function(){""===this.$textarea.val()&&this.$textarea.attr("rows",1)},validateSettings:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=new FormData;""!=this.$wpbuddyLicenseField.val()&&(s.append("wpbuddy_license_key",this.$wpbuddyLicenseField.val()),this.$wpbuddyAdminSpinner.addClass("is-active"),this.$wpbuddyLicenseStatusText.html(""),t.ajax({url:"".concat(WPBuddy.root,"wpbuddy/v1/validate-license"),type:"POST",data:s,processData:!1,contentType:!1,beforeSend:function(t){t.setRequestHeader("X-WP-Nonce",WPBuddy.nonce)},success:function(t){var s=this;t&&t.success&&(this.$wpbuddyLicenseStatusText.html('<p class="valid">'.concat(t.message,"</p>")),this.$wpbuddyAdminSpinner.removeClass("is-active"),setTimeout((function(){e&&s.$wpbuddySettingsForm[0].submit()}),200)),t&&!t.success&&(this.$wpbuddyLicenseStatusText.html('<p class="invalid">'.concat(t.message,"</p>")),this.$wpbuddyAdminSpinner.removeClass("is-active"))}.bind(this),error:function(t){console.log(t)},done:function(){this.$wpbuddyAdminSpinner.removeClass("is-active")}.bind(this)}))},toggleAccordion:function(e){e.preventDefault();var s=e.currentTarget;t(s).toggleClass("active"),t(s).parent().siblings().find(".wpbuddy-accordion__header").removeClass("active"),t(s).parent().siblings().find(".wpbuddy-accordion__body").slideUp(),t(s).next(".wpbuddy-accordion__body").slideToggle()}},e.init()}));
//# sourceMappingURL=wpbuddy-admin.min.js.map